<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Asistente Virtual May Roga</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Asistente Virtual May Roga</h1>
    <form id="accessForm">
        <label>Apodo (obligatorio):</label>
        <input type="text" id="apodo" name="apodo" required>
        <label>Selecciona servicio:</label>
        <select id="service_id" name="service_id" required>
            {% for key, s in services.items() %}
            <option value="{{key}}">{{s.name}} - ${{'%.2f' % (s.price/100)}}</option>
            {% endfor %}
        </select>
        <button type="submit">Pagar y acceder</button>
    </form>

    <script>
    const form = document.getElementById("accessForm");
    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const apodo = document.getElementById("apodo").value;
        const service_id = document.getElementById("service_id").value;
        
        const res = await fetch("/create-checkout-session", {
            method: "POST",
            body: new URLSearchParams({apodo, service_id})
        });
        const data = await res.json();
        if (data.id) {
            const stripe = Stripe("{{ STRIPE_PUBLISHABLE_KEY }}");
            stripe.redirectToCheckout({ sessionId: data.id });
        } else {
            alert("Error al crear sesi√≥n de pago");
        }
    });
    </script>
</body>
</html>
