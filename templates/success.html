<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asistente May Roga - Sesión Activa</title>
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; padding-top:40px; }
.container { background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1); width:90%; max-width:500px; }
h1 { color:#4CAF50; text-align:center; margin-bottom:20px; }
#assistant-output { border:1px solid #ddd; border-radius:8px; padding:10px; min-height:150px; max-height:300px; overflow-y:auto; background:#fafafa; }
#timer { font-weight:bold; color:#f44336; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
<h1>Asistente May Roga</h1>
<div id="assistant-output"></div>
<div id="timer"></div>
</div>

<script>
const backendURL = "https://asistente-virtual-may-roga.onrender.com";
const sessionId = "{{ session_id }}";
let service = null;

async function init(){
    try{
        const res = await fetch(`${backendURL}/get-session?session_id=${sessionId}`);
        const data = await res.json();
        service = data.product;
        startSSE(service);
    } catch(e){
        document.getElementById("assistant-output").innerText = "Error obteniendo la sesión.";
    }
}

function startSSE(service){
    const evtSource = new EventSource(`${backendURL}/assistant-stream?service=${service}`);
    const output = document.getElementById("assistant-output");
    evtSource.onmessage = (e) => {
        output.innerHTML += `<p>${e.data}</p>`;
        output.scrollTop = output.scrollHeight;
    }
    evtSource.onerror = () => { evtSource.close(); }
}

init();
</script>
</body>
</html>
